!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("@angular/core"),require("@angular/http"),require("rxjs/add/operator/map"),require("rxjs/operators"),require("@angular/forms"),require("@angular/common"),require("@angular/platform-browser/animations"),require("@angular/material"),require("@angular/common/http")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/http","rxjs/add/operator/map","rxjs/operators","@angular/forms","@angular/common","@angular/platform-browser/animations","@angular/material","@angular/common/http"],a):a((t.ng=t.ng||{},t.ng.location={}),t.ng.core,null,t.Rx.Observable.prototype,null,null,null,null,null,null)}(this,function(t,a,e,o,c,u,n,r,i,l){"use strict";var s=function(){function t(t){this.jsonp=t,this.apiList=[{key:"country",path:"https://battuta.medunes.net/api/country/all/?key={{token}}"},{key:"state",path:"https://battuta.medunes.net/api/region/{{country_code}}/all/?key={{token}}"},{key:"city",path:"https://battuta.medunes.net/api/city/{{country_code}}/search/?region={{city}}&key={{token}}"}]}return t.prototype.getDataFromCloud=function(t){var a=t+"&callback=JSONP_CALLBACK";return this.jsonp.request(a).map(function(t){return t.json()})},t.prototype.getApiList=function(){return this.apiList},t.decorators=[{type:a.Injectable}],t.ctorParameters=function(){return[{type:e.Jsonp}]},t}(),p="7430f867e8e468f50dfeb73faa250ad6",f=function(){function t(t){this.placesService=t,this.config={state:!0,city:!0},this.defaultApi="00000000000000000000000000000000"}return t.prototype.ngOnInit=function(){var e=this;for(var a in this.battutaToken||(this.battutaToken=p),this.locationData||(this.locationData={country:"",state:"",city:""}),this.formData=[{key:"country",placeholder:"Country",next:"state",prop:"name",data:[]},{key:"state",placeholder:"State",next:"city",prop:"region",data:[]},{key:"city",placeholder:"City",prop:"city",data:[]}],this.config.city=!1!==this.config.state&&this.config.city,this.config)if(!this.config[a]){var t=this.formData.findIndex(function(t){return t.key===a});this.formData.splice(t,1)}if(localStorage.getItem("locationcountry")){var o=localStorage.getItem("locationcountry");this.formData[0].data=this.formData[0].data.concat(JSON.parse(o))}else this.getData(this.formData[0],"country");for(var n=function(a){a[a.key]=new u.FormControl,a["filterData"+a.key]=a[a.key].valueChanges.pipe(c.startWith(""),c.map(function(t){return t?e._filterStates(t,a):a.data.slice()}))},r=0,i=this.formData;r<i.length;r++){n(i[r])}},t.prototype._filterStates=function(t,a){var e=t.toLowerCase();return a.data.filter(function(t){return 0===t[a.prop].toLowerCase().indexOf(e)})},t.prototype.getData=function(a,t){var e=this;if("country"!==t){if(a.next){var o=this.placesService.apiList.find(function(t){return t.key===a.next}),n=this.formData[0].data.find(function(t){return t.name===e.formData[0].country.value}),r=n?n.code:"";if(o){var i=o.path.replace("{{country_code}}",r).replace("{{token}}",this.battutaToken);"city"===a.next&&(i=i.replace("{{city}}",this.formData[1].state.value));var c=this.formData.find(function(t){return t.key===a.next});c&&this.placesService.getDataFromCloud(i).subscribe(function(t){c&&(c.data=t),e.resetField(a.next)},function(t){e.battutaToken=e.defaultApi,e.getData(a)})}}}else{var u=this.placesService.getApiList()[0].path.replace("{{token}}",this.battutaToken);this.placesService.getDataFromCloud(u).subscribe(function(t){e.formData[0].data=e.formData[0].data.concat(t),localStorage.setItem("locationcountry",JSON.stringify(t))},function(t){e.battutaToken=e.defaultApi,e.getData(a,"country")})}},t.prototype.resetField=function(a){var t=this.formData.find(function(t){return t.key===a});t&&(t[a].reset(),t.hasOwnProperty("next")&&this.resetField(t.next))},t.decorators=[{type:a.Component,args:[{selector:"angular5-location",template:'\n  <div *ngFor="let curdata of formData">\n\t<mat-form-field>\n<input matInput [(ngModel)]="locationData[curdata.key]" placeholder="{{curdata.placeholder}}" [matAutocomplete]="auto" [formControl]="curdata[curdata.key]">\n\t\t<mat-autocomplete #auto="matAutocomplete" (optionSelected)="getData(curdata)">\n\t\t\t<mat-option *ngFor="let options of curdata[\'filterData\'+curdata[\'key\']] | async" [value]="options[curdata.prop]" >\n\t\t\t\t<span>{{options[curdata.prop]}}</span>\n\t\t\t</mat-option>\n\t\t</mat-autocomplete>\n\t</mat-form-field>\n</div>\n  '}]}],t.ctorParameters=function(){return[{type:s}]},t.propDecorators={battutaToken:[{type:a.Input}],locationData:[{type:a.Input}],config:[{type:a.Input}]},t}(),d=function(){function t(){this.locationData={},this.locationConfig={state:!0,city:!0}}return t.decorators=[{type:a.Component,args:[{selector:"location-app",template:'<angular5-location [locationData]="locationData" [config]="locationConfig"></angular5-location>'}]}],t.ctorParameters=function(){return[]},t}(),m=function(){function t(){}return t.decorators=[{type:a.NgModule,args:[{imports:[r.BrowserAnimationsModule,n.CommonModule,l.HttpClientModule,e.HttpModule,e.JsonpModule,u.FormsModule,u.ReactiveFormsModule,i.MatAutocompleteModule,i.MatFormFieldModule,i.MatInputModule,i.MatOptionModule],providers:[l.HttpClient,s],declarations:[f,d],exports:[f],bootstrap:[d]}]}],t}();t.PlacesService=s,t.LocationModule=m,t.LocationComponent=f,Object.defineProperty(t,"__esModule",{value:!0})});